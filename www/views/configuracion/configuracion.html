<div id='console' class='table-responsive' style='padding:20px; font-size:12px; color:#404041; background-color:white;'>
<h2 id='trans_label_24'>Configuración</h2>
<!--<button type='button' class='btn btn-success' onclick='BajarLogo();'>Logo</button>-->
<div style='margin-top:25px; font-size:16px;'>
	 <!-- Nav tabs -->
	  <ul class="nav nav-tabs" role="tablist">
		<li role="presentation" class="active"><a href="#general" aria-controls="general" role="tab" data-toggle="tab">General</a></li>
		<li role="presentation"><a href="#ventastab" aria-controls="ventastab" role="tab" data-toggle="tab" class='trans_sales'>Ventas</a></li>
		<li role="presentation" id='tabclickimpuestos'><a href="#impuestostab" aria-controls="impuestostab" role="tab" data-toggle="tab" class='trans_imp'>Impuestos</a></li>
	  </ul>
	  <!-- Tab panes -->
	  <div class="tab-content">
		<div role="tabpanel" class="tab-pane active" id="general">
			<div style='text-align:center; margin:20px;'>
			<img id='logofull' width='120px'/><br/><br/>
			<span id='trans_label_79'>Puedes subir/cambiar tu logo en la nube, y este se sincronizará con tu dispositivo. </span><a id='cambiarlogo' target='_blank' >Subir logo</a>
			</div>
		<table class='table'>
		<tr><td style='text-align:right;' id="trans_label_62">País:</td><td><input id='tablet_pais' class='form-control' readonly /></td></tr>
		<tr><td style='text-align:right;' id="trans_label_25">Nombre Dispositivo:</td><td><input id='tablet_name' class='form-control' /></td></tr>
		<tr><td style='text-align:right;' id="trans_label_27">Version:</td><td><input id='tablet_version' class='form-control' readonly /></td></tr>
		<tr><td style='text-align:right;' id="trans_label_28">Numero Empresa:</td><td><input id='tablet_emp' class='form-control' readonly /></td></tr>
		<tr><td style='text-align:right;' id="trans_label_29">Cuenta/usuario:</td><td><input id='tablet_cuenta' class='form-control' readonly /></td></tr>
        <tr>
          <td  style='text-align:right;' id="trans_label_47">Idioma:</td>
          <td>
             <select id="idioma" name="idioma" class="form-control obligated" size="1">
              <option value="1">Español</option>
              <option value="2">English</option>
             </select>
          </td>
        </tr>
        <tr>
          <td  style='text-align:right;' id="trans_label_71">Tipo Sistema:</td>
          <td>
             <select id="version_nub" name="version_nub" class="form-control obligated" size="1" onchange="ver_version();">
              <option value="2" id="trans_label_73">Rápida</option>
              <option value="1" id="trans_label_72">Solo Código de Barras</option>
              <option value="3" id="trans_label_74">Restaurante</option>
             </select>
          </td>
        </tr>
		<tr>
			<td  style='text-align:right;' id="trans_label_80">Imprimir Logo</td>
			<td align='left'><input type='checkbox' id='printlogo' readonly onclick='ImprimirLogo();'/></td>
    	</tr>
        <tr>
			<td  style='text-align:right;' id="trans_label_75">Mensaje Personalizado</td>
			<td align='left'><input type='text' id='custommsg' class='form-control input'/></td>
    	</tr>
    	<tr>
    		<td  style='text-align:right;' id="trans_label_77">Respaldo de Información</td>
    		<td align='left'><input type='checkbox' id='backupinf' readonly /></td>
    	</tr>
		<tr>
			<td  style='text-align:right;' id="trans_label_78">Múltiple Tablet</td>
			<td align='left'><input type='checkbox' id='multitablet' readonly /></td>
		</tr>
        <tr>
            <td  style='text-align:right;'>LocalHost</td>
            <td align='left'><input id='con_localhost' class='form-control' readonly /></td>
		</tr>
		</table>
		</div>
		<div role="tabpanel" class="tab-pane" id="ventastab">
			<table class='table'>
			<tr><td  style='text-align:right; width:50%;' id="trans_label_26">Ver Diseño Menú:</td><td align='left'><input data-size='small' type='checkbox' id='tablet_menu' class='switch' /></td></tr>
				<tr>
					<td  style='text-align:right;' id="trans_label_48">Sin Documento de Cliente:</td>
					<td align='left'><input data-size='small' type='checkbox' id='sin_documento' class='switch' /></td>
				</tr>
				<tr>
					<td  style='text-align:right;' id="trans_label_49">Con Nombre en la Orden:</td>
					<td align='left'><input data-size='small' type='checkbox' id='con_orden' class='switch' /></td>
				</tr>
				<tr>
					<td  style='text-align:right;' id="trans_label_50">Con Propina:</td>
					<td align='left'><input data-size='small' type='checkbox' id='con_propina' class='switch' /></td>
				</tr>
				<tr>
					<td  style='text-align:right;' id="trans_label_51">Con Tarjeta:</td>
					<td align='left'><input data-size='small' type='checkbox' id='con_tarjeta' class='switch' /></td>
				</tr>
				<tr style="display: none;">
					<td  style='text-align:right;' id="trans_label_52">Con Shop:</td>
					<td align='left'><input data-size='small' type='checkbox' id='con_shop' class='switch' /></td>
				</tr>
				<tr>
					<td  style='text-align:right;' id="trans_label_56">Con Notas en Pedido:</td>
					<td align='left'><input data-size='small' type='checkbox' id='con_notas' class='switch' /></td>
				</tr>
				<tr>
					<td  style='text-align:right;' id="trans_label_57">Con Impresion para Comanderas:</td>
					<td align='left'><input data-size='small' type='checkbox' id='con_comanderas' class='switch'/></td>
				</tr>
				<tr style="display: none;">
					<td  style='text-align:right;' id="trans_label_58">Con Mesas:</td>
					<td align='left'><input data-size='small' type='checkbox' id='con_mesas' class='switch' /></td>
				</tr>
			</table>
		</div>
		<div role="tabpanel" class="tab-pane" id="impuestostab">
			<table class='table table-striped' id='confimpuestos' style='margin-top:30px; margin-bottom:20px;'>
			<thead><tr><th class='trans_name'>Nombre</th><th class='trans_percent'>Porcentaje (%)</th><th class='trans_consider'>Considerar</th></tr></thead>
			<tbody></tbody>
			</table>
		</div>
	  </div>
</div>
<div class='row'>
	<div class='col-lg-12' style='margin-bottom:35px;'>
		<button type='button' class='btn btn-success trans_save' onclick='GuardarNombre();'>Guardar</button>
	</div>
</div>
</div>
<script>
	$(document).ready(function(){
		//paquete
		var paquete=localStorage.getItem("paquete");
		//idioma
		var linklang="es";
		if(localStorage.getItem("idioma")==2)
			linklang="en";
		
		//alert(linklang);
			var xmlidioma=$.get("lang/"+linklang+".html",function(datos){
			d=JSON.parse(datos);
			var itemestructura=d.estructura;
			//console.log(itemestructura);
			var itemtitles=itemestructura.titles;
			var itembuttons=itemestructura.botones;
			var itemlabels=itemestructura.labels;
			var todostitles=itemtitles.item;
			var todosbuttons=itembuttons.item;
			var todoslabels=itemlabels.item;	
				for(var k=0;k<todostitles.length;k++){
					var miitemname=todostitles[k].name;
					//alert(miitemname);
					$('.'+miitemname).html(todostitles[k].text);
				}
				
				for(var k=0;k<todosbuttons.length;k++){
					var miitemname=todosbuttons[k].name;
					//alert(miitemname);
					$('.'+miitemname).html(todosbuttons[k].text);
				}
				
				for(var k=0;k<todoslabels.length;k++){
					//console.log(todoslabels[k].name+"/"+todoslabels[k].name);
					var miitemname=todoslabels[k].name;
					$('#'+miitemname).html(todoslabels[k].text);
				}
				
		});
	
		if(localStorage.getItem("logo")!=''&&localStorage.getItem("logo")!=null&&localStorage.getItem("logo").logo!=''){
			$('#logofull,#cambiarlogo').fadeIn();
			$('#logofull').attr('src','file:///data/data/com.practisis.practipos/files//'+localStorage.getItem("logo"));
		}else{
			//$('#logofull,#cambiarlogo').css("display","none");
			$('#cambiarlogo').fadeIn();
			$('#logofull').attr('src','img/nologo.png');
		}
		
		$('#cambiarlogo').attr("href","https://www.practisis.net/index3.php?rvpas="+localStorage.getItem("userPasswod")+"&rvus="+localStorage.getItem("userRegister"));
			
		$('#tablet_emp').val(localStorage.getItem("empresa"));
		var db = window.openDatabase("Database", "1.0", "PractisisMobile", 200000);
			db.transaction(function(tx1){
				tx1.executeSql("SELECT nombreterminal as c,id_idioma,id_version_nube,sin_documento,con_nombre_orden,con_propina,con_tarjeta,con_shop,con_notasorden,con_comanderas,con_localhost,con_mesas,pais,mensajefinal from CONFIG where id=1",[],function(tx1,results1){
					if(results1.rows.length>0){
						if(results1.rows.item(0).c!=''){
							$('#tablet_name').val(results1.rows.item(0).c);
							$('#tablet_pais').val(results1.rows.item(0).pais);
							$('#custommsg').val(results1.rows.item(0).mensajefinal);

							if(paquete==1){
								$('#custommsg').prop("readonly","readonly");
								$('#custommsg').click(function(){
									alert("Necesita Premium");
								});
							}
							
                            //alert(results1.rows.item(0).con_nombre_orden);
                            $('#idioma > option[value="'+results1.rows.item(0).id_idioma+'"]').attr('selected', 'selected');
                            $('#version_nub > option[value="'+results1.rows.item(0).id_version_nube+'"]').attr('selected', 'selected');
                            if(results1.rows.item(0).sin_documento=='true'){
                                $('#sin_documento').bootstrapSwitch('state', true);
                            }else{
                    			$('#sin_documento').bootstrapSwitch('state', false);
                    		}
                            if(results1.rows.item(0).con_nombre_orden=='true'){
                                $('#con_orden').bootstrapSwitch('state', true);
                            }else{
                    			$('#con_orden').bootstrapSwitch('state', false);
                    		}
                            if(results1.rows.item(0).con_propina=='true'){
                                $('#con_propina').bootstrapSwitch('state', true);
                            }else{
                    			$('#con_propina').bootstrapSwitch('state', false);
							}
                            if(results1.rows.item(0).con_tarjeta=='true'){
                                $('#con_tarjeta').bootstrapSwitch('state', true);
                            }else{
                    			$('#con_tarjeta').bootstrapSwitch('state', false);
                    		}
                            if(results1.rows.item(0).con_shop=='true'){
                                $('#con_shop').bootstrapSwitch('state', true);
                            }else{
                    			$('#con_shop').bootstrapSwitch('state', false);
                    		}
                            if(results1.rows.item(0).con_notasorden=='true'){
                                $('#con_notas').bootstrapSwitch('state', true);
                            }else{
                    			$('#con_notas').bootstrapSwitch('state', false);
                    		}
                            if(results1.rows.item(0).con_comanderas=='true'){
                                $('#con_comanderas').bootstrapSwitch('state', true);
                            }else{
                    			$('#con_comanderas').bootstrapSwitch('state', false);
                    		}
							if(results1.rows.item(0).con_mesas=='true'){
                                $('#con_mesas').bootstrapSwitch('state', true);
                            }else{
                    			$('#con_mesas').bootstrapSwitch('state', false);
                    		}
							//$('#con_mesas').bootstrapSwitch('readonly',true);
							//$('#con_shop').bootstrapSwitch('readonly',true);
							
                            //alert(results1.rows.item(0).con_localhost);
                            $('#con_localhost').val(results1.rows.item(0).con_localhost);
						}
					}
				});
				
				///consulta impuestostab
				if(localStorage.getItem('con_localhost')=="false"){
					$('#confimpuestos tbody').html('');
					tx1.executeSql("SELECT * FROM IMPUESTOS GROUP BY NOMBRE",[],function(tx1,results3){
						if(results3.rows.length>0){
							for(var t=0;t<results3.rows.length;t++){
								var itemimp=results3.rows.item(t);
								var esactivo=itemimp.activo;
								var porcen=itemimp.porcentaje;
								var nombreimp=itemimp.nombre;
								var timespanimp=itemimp.timespan;
								var checked='';
								if(esactivo=='true')
									checked='checked';
								var mifila='<tr><td style="text-align:left;">'+nombreimp.toUpperCase()+'</td><td  style="text-align:left;"><input id="impval_'+timespanimp+'" style="display:inline; width:60%;" type="text" class="input form-control imporcent" value="'+porcen+'"/><span style="display:inline;"> %</span></td><td  style="text-align:left;"><input id="impact_'+timespanimp+'" type="checkbox" '+checked+' data-size="mini"; /></td></tr>';
								$('#confimpuestos tbody').append(mifila);
								
								if(esactivo=='true'){
									$('#impact_'+timespanimp).bootstrapSwitch('state', true);
								}else{
									$('#impact_'+timespanimp).bootstrapSwitch('state', false);
								}
							}
						}
					});
				}else{
					$('#tabclickimpuestos').css("display","none");
				}
				
				///consulta impuestos
				
				}
			,errorCB,successCB);
			
		$('#tablet_menu').bootstrapSwitch();
        $('#sin_documento').bootstrapSwitch();
        $('#con_orden').bootstrapSwitch();
        $('#con_propina').bootstrapSwitch();
        $('#con_tarjeta').bootstrapSwitch();
        $('#con_shop').bootstrapSwitch();
        $('#con_notas').bootstrapSwitch();
        $('#con_comanderas').bootstrapSwitch();
        $('#con_mesas').bootstrapSwitch();
		$('#backupinf').bootstrapSwitch();
		$('#printlogo').bootstrapSwitch();
        $('#multitablet').bootstrapSwitch();

		if(localStorage.getItem("diseno")==1){
			$('#tablet_menu').bootstrapSwitch('state', true, true);
		}else{
			$('#tablet_menu').bootstrapSwitch('state', false, true);
		}
		
		$('#tablet_menu').on('switchChange.bootstrapSwitch', function(event, state) {
		  if(state){
			localStorage.setItem("diseno",1);
		  }else{
			localStorage.setItem("diseno",0);
		  }
		});
		
		$('#tablet_cuenta').val(localStorage.getItem("userRegister"));

		var app = document.URL.indexOf( 'http://' ) === -1 && document.URL.indexOf( 'https://' ) === -1;
		if ( app ) {
			cordova.getAppVersion.getVersionNumber().then(function (version) {
				$('#tablet_version').val(version);
			});
		}
	});
	
	
	function GuardarNombre(){
		var db = window.openDatabase("Database", "1.0", "PractisisMobile", 200000);
			db.transaction(function(tx1){
				var tabname=$('#tablet_name').val();

				if(tabname=='')
					tabname="Tablet "+$('#devicemodel').html();
					
				//tx1.executeSql("UPDATE CONFIG SET nombreterminal=?,sincronizar=? where id=1",[tabname,true],function(){
                var idioma = $('#idioma').val();
                var version_nub = $('#version_nub').val();
                var sin_documento = $('#sin_documento').bootstrapSwitch('state');
				localStorage.setItem('sin_documento',sin_documento);
                var con_orden = $('#con_orden').bootstrapSwitch('state');
                localStorage.setItem('con_nombre_orden',con_orden);
                var con_propina = $('#con_propina').bootstrapSwitch('state');
                var con_tarjeta = $('#con_tarjeta').bootstrapSwitch('state');
                localStorage.setItem("con_tarjeta",con_tarjeta);
                var con_shop = $('#con_shop').bootstrapSwitch('state');
                localStorage.setItem('con_shop',con_shop);
                localStorage.setItem('idioma',idioma);
                localStorage.setItem('propina',con_propina);
                var con_notas = $('#con_notas').bootstrapSwitch('state');
                var con_comanderas = $('#con_comanderas').bootstrapSwitch('state');
                var con_mesas = $('#con_mesas').bootstrapSwitch('state');
                localStorage.setItem('con_notas',con_notas);
                localStorage.setItem('con_comandas',con_comanderas);
                localStorage.setItem('con_mesas',con_mesas);
				
				if(tabname=='')
					tabname="Tablet "+$('#devicemodel').html();
					
				tx1.executeSql("UPDATE CONFIG SET nombreterminal=?,sincronizar=?,id_idioma=?,sin_documento=?,con_nombre_orden=?,con_propina=?,con_tarjeta=?,con_shop=?,con_notasorden=?,con_comanderas=?,con_mesas=?,id_version_nube=? where id=1",[tabname,true,idioma,sin_documento,con_orden,con_propina,con_tarjeta,con_shop,con_notas,con_comanderas,con_mesas,version_nub],
				function(tx1,results1){
					
					var linklang="es";
					if(localStorage.getItem("idioma")==2)
						linklang="en";
								
					if(localStorage.getItem("idioma")==1)
						showalert("Datos Guardados con exito.");
					else if(localStorage.getItem("idioma")==2)
						showalert("Successfully Saved.");
							
					var xmlidioma=$.get("lang/"+linklang+".html",function(datos){
					d=JSON.parse(datos);
					var itemestructura=d.estructura;
					//console.log(itemestructura);
					var itemmen=itemestructura.menu;
					var itemtitles=itemestructura.titles;
					var itembuttons=itemestructura.botones;
					var itemlabels=itemestructura.labels;
					var todostitles=itemtitles.item;
					var todosbuttons=itembuttons.item;
					var todoslabels=itemlabels.item;
					var todositems=itemmen.item;	
					
						for(var k=0;k<todositems.length;k++){
							var miitem=todositems[k];
							$('#lab_menu_'+parseInt(k+1)).html(miitem);
						}
							
						for(var k=0;k<todostitles.length;k++){
							var miitemname=todostitles[k].name;
							//alert(miitemname);
							$('.'+miitemname).html(todostitles[k].text);
						}
						
						for(var k=0;k<todosbuttons.length;k++){
							var miitemname=todosbuttons[k].name;
							//alert(miitemname);
							$('.'+miitemname).html(todosbuttons[k].text);
						}
						
						for(var k=0;k<todoslabels.length;k++){
							//console.log(todoslabels[k].name+"/"+todoslabels[k].name);
							var miitemname=todoslabels[k].name;
							$('#'+miitemname).html(todoslabels[k].text);
						}
						
				});
				});
				
				$('.imporcent').each(function(){
					var porcen=$(this).val();
					var idinp=$(this).attr('id');
					var datinp=idinp.split("_");
					var active=$('#impact_'+datinp[1]).bootstrapSwitch('state');
					tx1.executeSql("UPDATE IMPUESTOS set porcentaje=?,activo=?,sincronizar=? where timespan=?",[porcen,active,"true",datinp[1]],function(tx1,res2){
						console.log("impuesto actualizado");
					});
				});
				
				}
			,errorCB,successCB);
	}
	
function fail() {
    alert("failed to get filesystem");
}

function gotFS(fileSystem) {
    alert("got filesystem");
        // save the file system for later access
   
    window.rootFS = fileSystem.root;
	alert(fileSystem.root.fullPath);
	alert( cordova.file.dataDirectory);
}


function ImprimirLogo(){
	var paquete=localStorage.getItem("paquete");
	if(paquete==1){
		alert("Necesita Premium");
	}
}
	
	
function ver_version(){
  var version_nub = document.getElementById('version_nub').value;
  if(version_nub == '1'){
    localStorage.setItem("con_shop","true");
    localStorage.setItem("con_mesas","false");
    $('#con_shop').bootstrapSwitch('state', true);
    $('#con_mesas').bootstrapSwitch('state', false);
  }else if(version_nub == '2'){
    localStorage.setItem("con_shop","false");
    localStorage.setItem("con_mesas","false");
    $('#con_shop').bootstrapSwitch('state', false);
    $('#con_mesas').bootstrapSwitch('state', false);
  }else if(version_nub == '3'){
    localStorage.setItem("con_shop","false");
    localStorage.setItem("con_mesas","true");
    $('#con_shop').bootstrapSwitch('state', false);
    $('#con_mesas').bootstrapSwitch('state', true);
  }else{
    localStorage.setItem("con_shop","false");
    localStorage.setItem("con_mesas","false");
    $('#con_shop').bootstrapSwitch('state', false);
    $('#con_mesas').bootstrapSwitch('state', false);
  }
}
</script>