<style>
		.inputs{
			width:100%;
			border:1px solid #ccc;
			color:#57595B;
			border-radius: 2px 2px 2px 2px;
			-moz-border-radius: 2px 2px 2px 2px;
			-webkit-border-radius: 2px 2px 2px 2px;
		}
		textarea{
			resize:none;
		}
	</style>
	<div class='panel' id='sihayEmp' style='height:150%;'>
		<div  class="row" >
			<div class="col-sm-12">
				<h2 style="margin-left:15px;">Informacion de tu Empresa</h2>
				<hr color="gray" />
			</div>
			
			<div class='col-xs-1'></div>
			<div class='col-xs-10'>
				<div class="panel panel-default" style="padding:15px;">
					<div class="alert alert-danger" style='display:none;' id='campos'>
						Todos los campos requeridos
					</div>
					<div class="alert alert-success" style='display:none;' id='msjOk'>
						
					</div>
					<table class='table' style='width:80%;align:center !important;'>
						<tr>
							<th>
								Nombre Establecimiento : 
							</th>
							<td>
								<input type='text' id='nombreEsta' placeholder='Nombre Establecimiento' class='inputs'/>
							</td>
						</tr>
						<tr>
							<th>
								Razón Social : 
							</th>
							<td>
								<input type='text' id='razon' placeholder='Razón Social' class='inputs'/>
							</td>
						</tr>
						<tr>
							<th>
								Ruc : 
							</th>
							<td>
								<input type='text' id='ruc' placeholder='Ruc' class='inputs'/>
							</td>
						</tr>
						<tr>
							<th>
								Telefono : 
							</th>
							<td>
								<input type='number' id='tel' placeholder='Telefono' class='inputs'/>
							</td>
						</tr>
						<tr style='display:none;'>
							<th>
								Email : 
							</th>
							<td>
								<input type='text' id='email' placeholder='Email' class='inputs'/>
							</td>
						</tr>
						<tr>
							<th>
								No. Serie: 
							</th>
							<td>
								<input type='number' id='serie' placeholder='Serie' class='inputs'/>
							</td>
						</tr>
						<tr>
							<th>
								No. Establecimiento : 
							</th>
							<td>
								<input type='number' id='establecimiento' placeholder='Establecimiento' class='inputs'/>
							</td>
						</tr>
						<tr>
							<th>
								Dirección : 
							</th>
							<td>
								<textarea id='dir'  placeholder='Dirección...' class='inputs form-control'></textarea>
							</td>
						</tr>
						<tr>
							<td colspan='2' align='center' style='text-align:center;'>
								<center>
									<button type="button" class="btn btn-success" style='display:none;' id='actualiza' onclick='actualizar()'>Actualizar</button>
									<button type="button" class="btn btn-success" style='display:;' id='graba' onclick='grabar()'>Guardar</button>
									<br/>
								</center>
							</td>
						</tr>
					</table>
				</div>
			</div>
			<div class='col-xs-1'><button type="button" class="btn btn-success" id='backup' onclick='backupbdd();'>Backup</button></div>
		</div>

        <div id="myModalbdd" class="modal fade" role="dialog" style="margin-top: 25px;position: absolute;">
          <div class="modal-dialog">

            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Backup</h4>
              </div>
              <div class="modal-body" style="height: 450px;overflow-x: hidden;overflow-y: auto;">
                <div id="backupbdd">
                    { "Backup" : [
                    <div id="facturas"></div>
                    <div id="facturas_formulados"></div>
                    <div id="menu"></div>
                    <div id="menu_categorias"></div>
                    <div id="productos"></div>
                    ] }
                </div>
              </div>
            </div>

          </div>
        </div>
		<!---<div  class="row" >
			<div class='col-xs-1'></div>
			<div class='col-xs-10'>
				<div class="panel panel-default" style="padding:15px;">
					<button type="button" class="btn btn-primary" onclick="window.open('centvia://?udn=Impresion&utt=NubePOS&cru=nubeposv%3a%2f%2f&cruf=nubeposv%3a%2f%2f&c_=!+0+200+200+540+1%0d%0aTEXT+4+0+20+10+Prueba+de+Impresion%0d%0aTEXT+7+0+20+60+NubePOS%0d%0aENDML%0d%0aCONCAT+250+300%0d%0aENDCONCAT%0d%0a%0d%0aPRINT%0d%0a','_blank');">Probar Impresora</button>
				</div>
			</div>
		</div>-->
	</div>
<script type="text/javascript">
	$( document ).ready(function() {
		$('#sihayEmp').css('height',parseInt($(window).height())*150/100);
		saberDatosEmpresa();
	});
	function actualizar(){
		var nombreEsta = $('#nombreEsta').val();
		var razon = $('#razon').val();
		var ruc = $('#ruc').val();
		var tel = $('#tel').val();
		var email = $('#email').val();
		var dir = $('#dir').val();
		var serie = $('#serie').val();
		var establecimiento = $('#establecimiento').val();
		
		if(nombreEsta == '' ){
			$('#nombreEsta').effect('highlight');
		}
		
		if(razon == '' ){
			$('#razon').effect('highlight');
		}
		
		if(ruc == '' ){
			$('#ruc').effect('highlight');
		}
		if( tel == '' ){
			$('#tel').effect('highlight');
		}
		if(email == '' ){
			$('#email').effect('highlight');
		}
		if(dir == '' ){
			$('#dir').effect('highlight');
		}
		
		if(nombreEsta == '' || razon == '' || ruc == '' || tel == '' || email == '' || dir == '' ){
			$('#campos').fadeIn('slow');
			$('#msjOk').css('display','none');
			setTimeout(function() {
				$('#campos').fadeOut('slow');
			}, 3000);
		}else{
			var db = window.openDatabase("Database", "1.0", "PractisisMobile", 200000);
			db.transaction(function (tx){
				tx.executeSql('update CONFIG set nombre = "'+nombreEsta+'" , razon = "'+razon+'", ruc = '+ruc+' , telefono = '+tel+', email = "'+email+'", direccion = "'+dir+'",sincronizar="true",serie="'+serie+'",establecimiento="'+establecimiento+'"');
				$('#msjOk').html('Informacion actualizada con Éxito');
				$('#msjOk').fadeIn('slow');
				$('#campos').css('display','none');
				setTimeout(function() {
					$('#msjOk').fadeOut('slow');
				}, 3000);
			},errorCB,function(){$('#JSONempresaLocal').html('"empresa":{'+'"nombre":"'+nombreEsta+'","direccion":"'+dir+'"},');});
		}
		
	}
	function grabar(){
		var nombreEsta = $('#nombreEsta').val();
		var razon = $('#razon').val();
		var ruc = $('#ruc').val();
		var tel = $('#tel').val();
		var email = $('#email').val();
		var dir = $('#dir').val();
		var serie = $('#serie').val();
		var establecimiento = $('#establecimiento').val();
		
		if(nombreEsta == '' ){
			$('#nombreEsta').effect('highlight');
		}
		
		if(razon == '' ){
			$('#razon').effect('highlight');
		}
		
		if(ruc == '' ){
			$('#ruc').effect('highlight');
		}
		if( tel == '' ){
			$('#tel').effect('highlight');
		}
		if(email == '' ){
			$('#email').effect('highlight');
		}
		if(dir == '' ){
			$('#dir').effect('highlight');
		}
		
		if(nombreEsta == '' || razon == '' || ruc == '' || tel == '' || email == '' || dir == '' ){
			$('#campos').fadeIn('slow');
			$('#msjOk').css('display','none');
			setTimeout(function() {
				$('#campos').fadeOut('slow');
			}, 3000);
		}else{
			var db = window.openDatabase("Database", "1.0", "PractisisMobile", 200000);
			db.transaction(function (tx){
				tx.executeSql('INSERT INTO CONFIG(nombre , razon , ruc , telefono , email , direccion,serie,establecimiento) VALUES("'+nombreEsta+'" , "'+razon+'" , '+ruc+' , '+tel+' , "'+email+'" , "'+dir+'" , "'+serie+'" , "'+establecimiento+'")');
				$('#msjOk').html('Informacion Ingresada con Éxito');
				$('#msjOk').fadeIn('slow');
				$('#campos').css('display','none');
				setTimeout(function() {
					$('#msjOk').fadeOut('slow');
				}, 3000);
			},errorCB,successCB);
		}
	}
	function saberDatosEmpresa(){
		var db = window.openDatabase("Database", "1.0", "PractisisMobile", 200000);
		db.transaction(function(tx){
			tx.executeSql('SELECT * from CONFIG ',[],function(tx,results){
				if(results.rows.length>0){
					for (var i=0; i < results.rows.length; i++){
						var row = results.rows.item(i);
						var nombre = row.nombre;
						var razon = row.razon;
						var ruc = row.ruc;
						var telefono = row.telefono;
						var email = row.email;
						var direccion = row.direccion;
						var serie = row.serie;
						var establecimiento = row.establecimiento;
						
						$('#nombreEsta').val(nombre);
						$('#razon').val(razon);
						$('#ruc').val(ruc);
						$('#tel').val(telefono);
						$('#email').val(email);
						$('#dir').val(direccion);
						$('#serie').val(serie);
						$('#establecimiento').val(establecimiento);
					}
					
					$('#actualiza').css('display','block');
					$('#graba').css('display','none');
				}else{
					$('#actualiza').css('display','none');
					$('#graba').css('display','block');
				}
			});
		},errorCB,successCB);
	}
function backupbdd(){
  backupContent();
  $('#myModalbdd').modal('show');
}
// backup content
function backupContent() {
var db = window.openDatabase("Database", "1.0", "PractisisMobile", 200000);
 db.transaction(
  function(transaction) {
   transaction.executeSql('SELECT * FROM FACTURAS;', null,
    function (transaction, result) {
     if (result.rows.length > 0) {
      var tag = '{"FACTURAS":[';
      for (var i=0; i < result.rows.length; i++) {
       var row = result.rows.item(i);
       // expand and change this according to your table attributes
       tag = tag + '{"id":"' + row.id + '", "timespan":"' + row.timespan + '", "clientName":"' + row.clientName + '", "RUC":"' + row.RUC + '", "address":"' + row.address + '", "tele":"' + row.tele + '", "fetchJson":"' + row.fetchJson + '", "paymentsUsed":"' + row.paymentsUsed + '", "cash":"' + row.cash + '", "cards":"' + row.cards + '", "cheques":"' + row.cheques + '", "vauleCxC":"' + row.vauleCxC + '", "paymentConsumoInterno":"' + row.paymentConsumoInterno + '", "tablita":"' + row.tablita + '", "acc":"' + row.acc + '", "echo":"' + row.echo + '", "aux":"' + row.aux + '", "fecha":"' + row.fecha + '", "anulada":"' + row.anulada + '", "sincronizar":"' + row.sincronizar + '"}';
       if (i+1 < result.rows.length) {
        tag = tag + ',';
       }
      }
      tag = tag + ']}';
        //alert(tag);
        $('#facturas').html(tag+',');
     } else {
      alert("No content to backup.");
     }
    },
    errorHandlerSqlTransaction
   );
  }
 );
 db.transaction(
  function(transaction) {
   transaction.executeSql('SELECT * FROM FACTURAS_FORMULADOS;', null,
    function (transaction, result) {
     if (result.rows.length > 0) {
      var tag = '{"FACTURAS_FORMULADOS":[';
      for (var i=0; i < result.rows.length; i++) {
       var row = result.rows.item(i);
       // expand and change this according to your table attributes
       tag = tag + '{"id":"' + row.id + '", "timespan_factura":"' + row.timespan_factura + '", "timespan_formulado":"' + row.timespan_formulado + '", "cantidad":"' + row.cantidad + '", "precio_unitario":"' + row.precio_unitario + '"}';
       if (i+1 < result.rows.length) {
        tag = tag + ',';
       }
      }
      tag = tag + ']}';
        //alert(tag);
        $('#facturas_formulados').html(tag+',');
     } else {
      alert("No content to backup.");
     }
    },
    errorHandlerSqlTransaction
   );
  }
 );
 db.transaction(
  function(transaction) {
   transaction.executeSql('SELECT * FROM MENU;', null,
    function (transaction, result) {
     if (result.rows.length > 0) {
      var tag = '{"MENU":[';
      for (var i=0; i < result.rows.length; i++) {
       var row = result.rows.item(i);
       // expand and change this according to your table attributes
       tag = tag + '{"id":"' + row.id + '", "fila":"' + row.fila + '", "idcatmenu":"' + row.idcatmenu + '", "idproducto":"' + row.idproducto + '", "timespan":"' + row.timespan + '", "activo":"' + row.activo + '"}';
       if (i+1 < result.rows.length) {
        tag = tag + ',';
       }
      }
      tag = tag + ']}';
        //alert(tag);
        $('#menu').html(tag+',');
     } else {
      alert("No content to backup.");
     }
    },
    errorHandlerSqlTransaction
   );
  }
 );
 db.transaction(
  function(transaction) {
   transaction.executeSql('SELECT * FROM MENU_CATEGORIAS;', null,
    function (transaction, result) {
     if (result.rows.length > 0) {
      var tag = '{"MENU_CATEGORIAS":[';
      for (var i=0; i < result.rows.length; i++) {
       var row = result.rows.item(i);
       // expand and change this according to your table attributes
       tag = tag + '{"id":"' + row.id + '", "orden":"' + row.orden + '", "nombre":"' + row.nombre + '", "timespan":"' + row.timespan + '", "activo":"' + row.activo + '"}';
       if (i+1 < result.rows.length) {
        tag = tag + ',';
       }
      }
      tag = tag + ']}';
        //alert(tag);
        $('#menu_categorias').html(tag+',');
     } else {
      alert("No content to backup.");
     }
    },
    errorHandlerSqlTransaction
   );
  }
 );
 db.transaction(
  function(transaction) {
   transaction.executeSql('SELECT * FROM PRODUCTOS;', null,
    function (transaction, result) {
     if (result.rows.length > 0) {
      var tag = '{"PRODUCTOS":[';
      for (var i=0; i < result.rows.length; i++) {
       var row = result.rows.item(i);
       // expand and change this according to your table attributes
       tag = tag + '{"id_local":"' + row.id_local + '", "formulado":"' + row.formulado + '", "codigo":"' + row.codigo + '", "precio":"' + row.precio + '", "categoriaid":"' + row.categoriaid + '", "cargaiva":"' + row.cargaiva + '", "productofinal":"' + row.productofinal + '", "materiaprima":"' + row.materiaprima + '", "timespan":"' + row.timespan + '", "ppq":"' + row.ppq + '", "color":"' + row.color + '", "servicio":"' + row.servicio + '", "estado":"' + row.estado + '", "sincronizar":"' + row.sincronizar + '"}';
       if (i+1 < result.rows.length) {
        tag = tag + ',';
       }
      }
      tag = tag + ']}';
        //alert(tag);
        $('#productos').html(tag);
     } else {
      alert("No content to backup.");
     }
    },
    errorHandlerSqlTransaction
   );
  }
 );
}
function errorHandlerSqlTransaction(error) {
  //alert(error);
	console.error('SQLite - Error code: ' + error.code + ' - Error message: ' + error.message);
	return true;
}
</script>